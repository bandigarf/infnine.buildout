<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="infnine.data">
<head>
</head>

<body>
<div metal:fill-slot="main">

    <div tal:replace="structure provider:plone.abovecontenttitle" />

    <h1 class="documentFirstHeading" tal:content="context/title" />

    <div class="documentDescription" tal:content="context/description" />

    <div tal:replace="structure provider:plone.abovecontentbody" />
    <!-- Sorting Publications by project-->
    <div tal:define="projectlist python: []">
        <div tal:define="pubs python: context.getParentNode().objectValues(['Publication'])">
            <div tal:repeat="item pubs">
                <div tal:condition="python: not(item.bib2html_funding in projectlist) and not(item.bib2html_funding in ['ignore', '', None])"
                     tal:replace="python: projectlist.append(item.bib2html_funding)">PROJECTLIST
                </div>
            </div>
    <h1>Publications Sorted by:</h1>
    <span tal:define="tableitems python: ['Year', 'Author', 'Project', 'Publication Type'];
                      tableurls python: ['by_year', 'by_author', 'by_project', 'by_publication_type']">
        <table class="invisible" width=100%>
            <tr>
                <td tal:repeat="item tableitems"><a tal:define="n repeat/item/number" tal:attributes="href python: context.getId() + '/' + tableurls[n-1]"><h3 tal:content="item" /></a></td>
            </tr>
        </table>
    </span>

    <!--Project List-->
            <div tal:replace="python: projectlist.sort()">PROJECTLIST</div>
            <div tal:replace="python: projectlist.reverse()">PROJECTLIST</div>
            <div tal:replace="python: projectlist.append('Non-Classified')" />
            <span tal:define="projectlist1 python: [project for project in projectlist if project != None]" tal:repeat="project projectlist1">
                <!--Reference to Location inside the Page-->
                <a href="link" tal:attributes="href python: context.getId() + '/by_project#' + project" tal:content="project">PROJECTLIST</a>
            </span>

    <!--Publications Display-->
            <!-- author_list defined in data/content/publicationlisting.py-->
            <div tal:define="authorlist context/author_list">
            <ul tal:repeat="project projectlist">
            <h2> <a name="" tal:attributes="name project" tal:content="project">PROJECT</a></h2>
                <div tal:repeat="pub pubs">
                <li tal:condition="python: (pub.bib2html_funding == project) or ((project == 'Non-Classified') and (pub.bib2html_funding in ['ignore', '', None]))">
                    <span tal:condition="pub/author | nothing">
                        <!--Display authors with bold link if members of chair, only bold if members
                        and have no page in portal.people and diplay normal if they are externals-->
                        <span tal:define="namelist python: `pub.author`.split(' and ')">
                            <span tal:repeat="fullname namelist" >
                            <span tal:define="names python: fullname.split(' ')">
                            <!--is author external for later use-->
                            <span tal:define="global isExt python: True">
                            <span tal:repeat="name names">
                            <!--is author in the list of chair members for later use-->
                            <span tal:define="isInList python: ' '">
                            <!-- .fN is defined in content/publicationlisting.py-->
                                <span tal:define="namelower python: context.fN(name.rstrip('\''))">
                                    <span   tal:condition="python: namelower in authorlist"
                                            tal:define="isInList python: context.fN(name.rstrip('\''))">  
                                        <!--Chair Members with Person page-->
                                        <b  tal:condition="python: isInList">
                                            <a tal:condition="python: 
                                            portal.people.__contains__(isInList)"
                                            href="link" tal:attributes="href python: context.portal_url() + '/people/' + isInList"
                                            tal:content="python: 
                                            portal.people.__getitem__(isInList).title" 
                                            tal:define="global isExt python: False">
                                            </a>
                                        </b>
                                        <!--Chair Members withOUT Person page-->
                                        <b   tal:condition="python: isInList">
                                            <!-- .fNU is defined in content/publicationlisting.py-->
                                            <span tal:condition="python: 
                                            not (portal.people.__contains__(isInList))"
                                            tal:content="python: context.fNU(fullname.lstrip('u\'').rstrip('\''))">
                                            </span>
                                        </b>
                                    </span> 
                                </span>
                            </span> 
                            </span>
                                        <!--Externals-->
                                <span   tal:condition="python: isExt == True" 
                                        tal:content="python: context.fNU(fullname.lstrip('u\'').rstrip('\''))">
                                </span>
                            </span>,
                            </span>
                            </span>
                        </span>
                    </span>
                    <a tal:condition="pub/title | nothing"
                       tal:attributes="href pub/id">
                        <span>
                            <em tal:content="pub/title">Title</em>,
                        </span>
                    </a>
                    <span tal:condition="pub/pubtype | nothing">
                        <p tal:condition="pub/pubtype" tal:replace="pub/pubtype">Pubtype</p>,
                    </span>
                    <span tal:condition="pub/year | nothing">
                        <p tal:replace="pub/year">Year</p>,
                    </span>
                    <span tal:define="published_in pub/journal | nothing"
                          tal:condition="published_in">
                        <p tal:replace="published_in">Published in</p>,
                    </span>
                    <span tal:define="published_in pub/booktitle | nothing"
                          tal:condition="published_in">
                        <p tal:replace="published_in">Published in</p>,
                    </span>
                    <div>
                        <span tal:condition="python: pub.id + '.bib' in portal.publications.bibtex.keys()">
                            (<a tal:attributes="href python: 'bibtex/' + pub.id + '.bib/view'">BibTeX</a>)
                        </span>
                        <span tal:condition="python: pub.id + '.pdf' in portal.publications.pdf.keys()">
                            (<a tal:attributes="href python: 'pdf/' + pub.id + '.pdf'">PDF</a>)
                        </span>
                    </div>
                </li>
                </div>
            </ul>
            </div>
        </div>
    </div>
    <div tal:replace="structure provider:plone.belowcontentbody" />

</div>
</body>
</html>
